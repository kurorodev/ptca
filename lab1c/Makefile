
CC = gcc
CFLAGS = -Wall -std=c99 -I. -g
BIN_DIR = bin

# –û–±—â–∏–µ –∏—Å—Ö–æ–¥–Ω—ã–µ —Ñ–∞–π–ª—ã (—É—Ç–∏–ª–∏—Ç—ã)
UTILS_SOURCES = utils/utils.c
UTILS_OBJECTS = $(UTILS_SOURCES:.c=.o)

# –§–∞–π–ª—ã –¥–ª—è –ú–∏–ª–∏
MEALY_SOURCES = mealy/mealy.c mealy/main_mealy.c
MEALY_OBJECTS = $(MEALY_SOURCES:.c=.o)
MEALY_TARGET = $(BIN_DIR)/mealy_simulator

# –§–∞–π–ª—ã –¥–ª—è –ú—É—Ä–∞
MOORE_SOURCES = moore/moore.c moore/main_moore.c
MOORE_OBJECTS = $(MOORE_SOURCES:.c=.o)
MOORE_TARGET = $(BIN_DIR)/moore_simulator

# –¶–µ–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
all: mealy moore

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –±–∏–Ω–∞—Ä–Ω–∏–∫–æ–≤
$(BIN_DIR):
	mkdir -p $(BIN_DIR)

# –ö–æ–º–ø–∏–ª—è—Ü–∏—è –æ–±—â–∏—Ö —É—Ç–∏–ª–∏—Ç
utils/%.o: utils/%.c
	$(CC) $(CFLAGS) -c $< -o $@

# –ö–æ–º–ø–∏–ª—è—Ü–∏—è —Ñ–∞–π–ª–æ–≤ –ú–∏–ª–∏
mealy/%.o: mealy/%.c
	$(CC) $(CFLAGS) -c $< -o $@

# –ö–æ–º–ø–∏–ª—è—Ü–∏—è —Ñ–∞–π–ª–æ–≤ –ú—É—Ä–∞
moore/%.o: moore/%.c
	$(CC) $(CFLAGS) -c $< -o $@

# –°–±–æ—Ä–∫–∞ —Å–∏–º—É–ª—è—Ç–æ—Ä–∞ –ú–∏–ª–∏
mealy: $(BIN_DIR) $(UTILS_OBJECTS) $(MEALY_OBJECTS)
	$(CC) $(CFLAGS) -o $(MEALY_TARGET) $(UTILS_OBJECTS) $(MEALY_OBJECTS)
	@echo "‚úÖ –ê–≤—Ç–æ–º–∞—Ç –ú–∏–ª–∏ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω: $(MEALY_TARGET)"

# –°–±–æ—Ä–∫–∞ —Å–∏–º—É–ª—è—Ç–æ—Ä–∞ –ú—É—Ä–∞
moore: $(BIN_DIR) $(UTILS_OBJECTS) $(MOORE_OBJECTS)
	$(CC) $(CFLAGS) -o $(MOORE_TARGET) $(UTILS_OBJECTS) $(MOORE_OBJECTS)
	@echo "‚úÖ –ê–≤—Ç–æ–º–∞—Ç –ú—É—Ä–∞ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω: $(MOORE_TARGET)"

# –ó–∞–ø—É—Å–∫ —Å–∏–º—É–ª—è—Ç–æ—Ä–∞ –ú–∏–ª–∏ (–∫–æ–º–ø–∏–ª—è—Ü–∏—è + –∑–∞–ø—É—Å–∫)
run-mealy: mealy
	@echo "üöÄ –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–º–∞—Ç–∞ –ú–∏–ª–∏..."
	./$(MEALY_TARGET)

# –ó–∞–ø—É—Å–∫ —Å–∏–º—É–ª—è—Ç–æ—Ä–∞ –ú—É—Ä–∞ (–∫–æ–º–ø–∏–ª—è—Ü–∏—è + –∑–∞–ø—É—Å–∫)
run-moore: moore
	@echo "üöÄ –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–º–∞—Ç–∞ –ú—É—Ä–∞..."
	./$(MOORE_TARGET)

# –ö–æ–º–ø–∏–ª—è—Ü–∏—è —Ç–æ–ª—å–∫–æ –ú–∏–ª–∏ (–æ—Ç–¥–µ–ª—å–Ω–æ)
mealy-only: $(BIN_DIR) $(UTILS_OBJECTS) $(MEALY_OBJECTS)
	$(CC) $(CFLAGS) -o $(MEALY_TARGET) $(UTILS_OBJECTS) $(MEALY_OBJECTS)
	@echo "‚úÖ –ê–≤—Ç–æ–º–∞—Ç –ú–∏–ª–∏ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω: $(MEALY_TARGET)"

# –ö–æ–º–ø–∏–ª—è—Ü–∏—è —Ç–æ–ª—å–∫–æ –ú—É—Ä–∞ (–æ—Ç–¥–µ–ª—å–Ω–æ)
moore-only: $(BIN_DIR) $(UTILS_OBJECTS) $(MOORE_OBJECTS)
	$(CC) $(CFLAGS) -o $(MOORE_TARGET) $(UTILS_OBJECTS) $(MOORE_OBJECTS)
	@echo "‚úÖ –ê–≤—Ç–æ–º–∞—Ç –ú—É—Ä–∞ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω: $(MOORE_TARGET)"

# –û—á–∏—Å—Ç–∫–∞
clean:
	rm -rf $(BIN_DIR)
	rm -f $(UTILS_OBJECTS) $(MEALY_OBJECTS) $(MOORE_OBJECTS)
	@echo "üßπ –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"

.PHONY: all mealy moore run-mealy run-moore mealy-only moore-only clean
